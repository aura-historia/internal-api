openapi: 3.0.0
info:
  title: Aura-Historia Backend API
  description: |
    REST API for the Aura-Historia backend.

    The backend is written in Rust and utilizes event-driven architecture with CQRS and Event-Sourcing,
    hosted entirely on AWS using services like API Gateway, OpenSearch, DynamoDB, SQS, and Lambda.
  version: 1.0.0
  contact:
    name: Aura-Historia Team
    url: https://aura-historia.com/
  license:
    name: License
    url: https://github.com/aura-historia/backend/blob/develop/LICENSE

servers:
  - url: https://api.dev.aura-historia.com
    description: Full Development-Server

paths:
  /api/v1/shops/{shopId}/products/{shopsProductId}:
    get:
      summary: Get a single product
      description: |
        Retrieves a single product by its shop ID and shop's product ID.
        Returns localized content based on Accept-Language header and currency preferences.

        **Personalization**: When authenticated (via optional Authorization header), the response includes
        user-specific state such as whether the product is on the user's watchlist and notification preferences.
        Anonymous requests receive product data without user state.
      operationId: getProduct
      tags:
        - Products
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: shopsProductId
          in: path
          required: true
          description: Shop's unique identifier for the product. Can be any arbitrary string.
          schema:
            type: string
            example: "6ba7b810"
        - name: currency
          in: query
          required: false
          description: Currency for price display
          schema:
            $ref: "#/components/schemas/CurrencyData"
          example: EUR
        - name: Accept-Language
          in: header
          required: false
          description: |
            Preferred language for localized content.
            Supports quality values and multiple languages.
            Supported languages: de, en, fr, es (with regional variants).
          schema:
            type: string
            pattern: '^([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)(,([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)*)*$'
          examples:
            single:
              value: "de"
              description: "German"
            multiple:
              value: "en;q=0.9,de;q=0.8"
              description: "English preferred, German as fallback"
            regional:
              value: "en-US"
              description: "US English"
      security:
        - BearerAuth: []
        - {}
      responses:
        "200":
          description: Product found and returned successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: "#/components/schemas/LanguageData"
              example: "de"
            ETag:
              description: The event ID of the product for caching
              schema:
                type: string
                format: uuid
              example: '"550e8400-e29b-41d4-a716-446655440001"'
            Last-Modified:
              description: When the product was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2020 00:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonalizedGetProductData"
              examples:
                authenticated:
                  summary: Authenticated user response with watchlist state
                  value:
                    item:
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      productSlugId: "amazing-product-fa87c4"
                      shopSlugId: "my-shop"
                      eventId: "550e8400-e29b-41d4-a716-446655440001"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      shopName: "My Shop"
                      shopType: "COMMERCIAL_DEALER"
                      title:
                        text: "Amazing Product"
                        language: "en"
                      description:
                        text: "This is an amazing product description"
                        language: "en"
                      price:
                        currency: "EUR"
                        amount: 2999
                      priceEstimateMin:
                        currency: "EUR"
                        amount: 2500
                      priceEstimateMax:
                        currency: "EUR"
                        amount: 3500
                      state: "AVAILABLE"
                      url: "https://my-shop.com/products/amazing-product"
                      images:
                        - url: "https://my-shop.com/images/product-1.jpg"
                          prohibitedContent: "NONE"
                        - url: "https://my-shop.com/images/product-2.jpg"
                          prohibitedContent: "NONE"
                      originYear: 1837
                      authenticity: "ORIGINAL"
                      condition: "EXCELLENT"
                      provenance: "PARTIAL"
                      restoration: "MINOR"
                      created: "2024-01-01T10:00:00Z"
                      updated: "2024-01-01T12:00:00Z"
                    userState:
                      watchlist:
                        watching: true
                        notifications: true
                anonymous:
                  summary: Anonymous user response without user state
                  value:
                    item:
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      productSlugId: "amazing-product-fa87c4"
                      shopSlugId: "my-shop"
                      eventId: "550e8400-e29b-41d4-a716-446655440001"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      shopName: "My Shop"
                      shopType: "COMMERCIAL_DEALER"
                      title:
                        text: "Amazing Product"
                        language: "en"
                      description:
                        text: "This is an amazing product description"
                        language: "en"
                      price:
                        currency: "EUR"
                        amount: 2999
                      priceEstimateMin:
                        currency: "EUR"
                        amount: 2800
                      priceEstimateMax:
                        currency: "EUR"
                        amount: 3200
                      state: "AVAILABLE"
                      url: "https://my-shop.com/products/amazing-product"
                      images:
                        - url: "https://my-shop.com/images/product-1.jpg"
                          prohibitedContent: "NONE"
                        - url: "https://my-shop.com/images/product-2.jpg"
                          prohibitedContent: "NONE"
                      originYearMax: 1950
                      authenticity: "QUESTIONABLE"
                      condition: "GOOD"
                      provenance: "CLAIMED"
                      restoration: "MAJOR"
                      created: "2024-01-01T10:00:00Z"
                      updated: "2024-01-01T12:00:00Z"
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PARAMETER"
                    source:
                      field: "shopId"
                      sourceType: "path"
                missing_shops_product_id:
                  summary: Missing shop's product ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PARAMETER"
                    source:
                      field: "shopsProductId"
                      sourceType: "path"
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "PRODUCT_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/by-slug/shops/{shopSlugId}/products/{productSlugId}:
    get:
      summary: Get a single product by slug
      description: |
        Retrieves a single product by its shop slug ID and product slug ID.
        Returns localized content based on Accept-Language header and currency preferences.

        **Human-Readable Identifiers**: This endpoint uses slug-based identifiers which are human-readable
        kebab-case strings. Shop slugs are derived from the shop name (e.g., "tech-store-premium"),
        while product slugs combine the product title with a unique 6-character hexadecimal suffix
        (e.g., "amazing-product-fa87c4").

        **Personalization**: When authenticated (via optional Authorization header), the response includes
        user-specific state such as whether the product is on the user's watchlist and notification preferences.
        Anonymous requests receive product data without user state.
      operationId: getProductBySlug
      tags:
        - Products
      parameters:
        - name: shopSlugId
          in: path
          required: true
          description: Human-readable slug identifier of the shop (kebab-case, derived from shop name)
          schema:
            type: string
            pattern: '^[a-z0-9]+(-[a-z0-9]+)*$'
            example: "tech-store-premium"
        - name: productSlugId
          in: path
          required: true
          description: |
            Human-readable slug identifier of the product (kebab-case with 6-character hex suffix).
            Format: {product-title}-{6-char-hex} where the title is derived from the product name.
          schema:
            type: string
            pattern: '^[a-z0-9]+(-[a-z0-9]+)*-[a-f0-9]{6}$'
            example: "amazing-product-fa87c4"
        - name: currency
          in: query
          required: false
          description: Currency for price display
          schema:
            $ref: "#/components/schemas/CurrencyData"
          example: EUR
        - name: Accept-Language
          in: header
          required: false
          description: |
            Preferred language for localized content.
            Supports quality values and multiple languages.
            Supported languages: de, en, fr, es (with regional variants).
          schema:
            type: string
            pattern: '^([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)(,([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)*)*$'
          examples:
            single:
              value: "de"
              description: "German"
            multiple:
              value: "en;q=0.9,de;q=0.8"
              description: "English preferred, German as fallback"
            regional:
              value: "en-US"
              description: "US English"
      security:
        - BearerAuth: []
        - {}
      responses:
        "200":
          description: Product found and returned successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: "#/components/schemas/LanguageData"
              example: "de"
            ETag:
              description: The event ID of the product for caching
              schema:
                type: string
                format: uuid
              example: '"550e8400-e29b-41d4-a716-446655440001"'
            Last-Modified:
              description: When the product was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2020 00:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonalizedGetProductData"
              examples:
                authenticated:
                  summary: Authenticated user response with watchlist state
                  value:
                    item:
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      productSlugId: "amazing-product-fa87c4"
                      shopSlugId: "tech-store-premium"
                      eventId: "550e8400-e29b-41d4-a716-446655440001"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      shopName: "Tech Store Premium"
                      shopType: "COMMERCIAL_DEALER"
                      title:
                        text: "Amazing Product"
                        language: "en"
                      description:
                        text: "This is an amazing product description"
                        language: "en"
                      price:
                        currency: "EUR"
                        amount: 2999
                      state: "AVAILABLE"
                      url: "https://tech-store-premium.com/products/amazing-product"
                      images:
                        - url: "https://tech-store-premium.com/images/product-1.jpg"
                          prohibitedContent: "NONE"
                      created: "2024-01-01T10:00:00Z"
                      updated: "2024-01-01T12:00:00Z"
                    userState:
                      watchlist:
                        watching: true
                        notifications: true
                anonymous:
                  summary: Anonymous user response without user state
                  value:
                    item:
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      productSlugId: "amazing-product-fa87c4"
                      shopSlugId: "tech-store-premium"
                      eventId: "550e8400-e29b-41d4-a716-446655440001"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      shopName: "Tech Store Premium"
                      shopType: "COMMERCIAL_DEALER"
                      title:
                        text: "Amazing Product"
                        language: "en"
                      state: "AVAILABLE"
                      url: "https://tech-store-premium.com/products/amazing-product"
                      images: []
                      created: "2024-01-01T10:00:00Z"
                      updated: "2024-01-01T12:00:00Z"
                    userState: null
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_slug_id:
                  summary: Missing shop slug ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopSlugId"
                      sourceType: "path"
                    detail: "Missing field 'shopSlugId'."
                missing_product_slug_id:
                  summary: Missing product slug ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "productSlugId"
                      sourceType: "path"
                    detail: "Missing field 'productSlugId'."
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "PRODUCT_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/shops/{shopId}/products/{shopsProductId}/history:
    get:
      summary: Get product event history
      description: |
        Retrieves the event history for a specific product by its shop ID and shop's product ID.
        Returns an array of events representing state changes, price changes, and other significant 
        product lifecycle events, ordered chronologically.
        
        Returns localized content based on Accept-Language header and currency preferences for 
        price information in the event payloads.
      operationId: getProductHistory
      tags:
        - Products
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: shopsProductId
          in: path
          required: true
          description: Shop's unique identifier for the product. Can be any arbitrary string.
          schema:
            type: string
            example: "6ba7b810"
        - name: currency
          in: query
          required: false
          description: Currency for price display in event payloads
          schema:
            $ref: "#/components/schemas/CurrencyData"
          example: EUR
        - name: Accept-Language
          in: header
          required: false
          description: |
            Preferred language for localized content.
            Supports quality values and multiple languages.
            Supported languages: de, en, fr, es (with regional variants).
          schema:
            type: string
            pattern: '^([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)(,([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)*)*$'
          examples:
            single:
              value: "de"
              description: "German"
            multiple:
              value: "en;q=0.9,de;q=0.8"
              description: "English preferred, German as fallback"
            regional:
              value: "en-US"
              description: "US English"
      responses:
        "200":
          description: Product history retrieved successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: "#/components/schemas/LanguageData"
              example: "de"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/GetProductEventData"
              examples:
                product_history:
                  summary: Example product history
                  value:
                    - eventType: "CREATED"
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      eventId: "650e8400-e29b-41d4-a716-446655440001"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      payload:
                        price:
                          currency: "EUR"
                          amount: 3000
                        state: "LISTED"
                      timestamp: "2024-01-01T10:00:00Z"
                    - eventType: "STATE_AVAILABLE"
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      eventId: "650e8400-e29b-41d4-a716-446655440002"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      payload:
                        oldState: "LISTED"
                        newState: "AVAILABLE"
                      timestamp: "2024-01-02T14:30:00Z"
                    - eventType: "PRICE_DROPPED"
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      eventId: "650e8400-e29b-41d4-a716-446655440003"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      payload:
                        oldPrice:
                          currency: "EUR"
                          amount: 3000
                        newPrice:
                          currency: "EUR"
                          amount: 2999
                      timestamp: "2024-01-15T09:15:00Z"
        "400":
          description: Bad request - Invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PARAMETER"
                    source:
                      field: "shopId"
                      sourceType: "path"
                missing_shops_product_id:
                  summary: Missing shop's product ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PARAMETER"
                    source:
                      field: "shopsProductId"
                      sourceType: "path"
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "PRODUCT_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/shops/{shopId}/products/{shopsProductId}/similar:
    get:
      summary: Get similar products
      description: |
        Retrieves products similar to the specified product using semantic search based on text embeddings.
        Returns localized content based on Accept-Language header and currency preferences.

        **Personalization**: When authenticated (via optional Authorization header), the response includes
        user-specific state for each similar product (watchlist status, notifications).
        Anonymous requests receive product data without user state.

        **Asynchronous Processing**: If the product's text embedding has not yet been computed (typically for
        products created less than 24 hours ago), the endpoint returns 202 Accepted with a Location header
        to poll. The embedding generation runs nightly via batch processing.
      operationId: getSimilarProducts
      tags:
        - Products
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: shopsProductId
          in: path
          required: true
          description: Shop's unique identifier for the product
          schema:
            type: string
            example: "6ba7b810"
        - name: currency
          in: query
          required: false
          description: Currency for price display
          schema:
            $ref: "#/components/schemas/CurrencyData"
          example: EUR
        - name: Accept-Language
          in: header
          required: false
          description: |
            Preferred language for localized content.
            Supports quality values and multiple languages.
            Supported languages: de, en, fr, es (with regional variants).
          schema:
            type: string
            pattern: '^([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)(,([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)*)*$'
          examples:
            single:
              value: "de"
              description: "German"
            multiple:
              value: "en;q=0.9,de;q=0.8"
              description: "English preferred, German as fallback"
      security:
        - BearerAuth: []
        - {}
      responses:
        "200":
          description: Similar products found and returned successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PersonalizedGetProductSummaryData"
                description: Array of similar products, each with optional user state
              examples:
                authenticated:
                  summary: Authenticated user response with user state for each product
                  value:
                    - item:
                        productId: "660e8400-e29b-41d4-a716-446655440001"
                        productSlugId: "similar-product-a1b2c3"
                        shopSlugId: "my-shop"
                        eventId: "660e8400-e29b-41d4-a716-446655440011"
                        shopId: "550e8400-e29b-41d4-a716-446655440000"
                        shopsProductId: "6ba7b811"
                        shopName: "My Shop"
                        shopType: "COMMERCIAL_DEALER"
                        title:
                          text: "Similar Product"
                          language: "en"
                        price:
                          currency: "EUR"
                          amount: 2899
                        state: "AVAILABLE"
                        url: "https://my-shop.com/products/similar-product"
                        images:
                          - url: "https://my-shop.com/images/similar-1.jpg"
                            prohibitedContent: "NONE"
                        created: "2024-01-01T10:00:00Z"
                        updated: "2024-01-01T12:00:00Z"
                      userState:
                        watchlist:
                          watching: true
                          notifications: false
                    - item:
                        productId: "770e8400-e29b-41d4-a716-446655440002"
                        productSlugId: "another-similar-item-d4e5f6"
                        shopSlugId: "my-shop"
                        eventId: "770e8400-e29b-41d4-a716-446655440012"
                        shopId: "550e8400-e29b-41d4-a716-446655440000"
                        shopsProductId: "6ba7b812"
                        shopName: "My Shop"
                        shopType: "COMMERCIAL_DEALER"
                        title:
                          text: "Another Similar Item"
                          language: "en"
                        price:
                          currency: "EUR"
                          amount: 3199
                        state: "AVAILABLE"
                        url: "https://my-shop.com/products/another-item"
                        images: []
                        created: "2024-01-01T11:00:00Z"
                        updated: "2024-01-01T13:00:00Z"
                      userState:
                        watchlist:
                          watching: false
                          notifications: false
                anonymous:
                  summary: Anonymous user response without user state
                  value:
                    - item:
                        productId: "660e8400-e29b-41d4-a716-446655440001"
                        productSlugId: "similar-product-a1b2c3"
                        shopSlugId: "my-shop"
                        eventId: "660e8400-e29b-41d4-a716-446655440011"
                        shopId: "550e8400-e29b-41d4-a716-446655440000"
                        shopsProductId: "6ba7b811"
                        shopName: "My Shop"
                        shopType: "COMMERCIAL_DEALER"
                        title:
                          text: "Similar Product"
                          language: "en"
                        price:
                          currency: "EUR"
                          amount: 2899
                        state: "AVAILABLE"
                        url: "https://my-shop.com/products/similar-product"
                        images:
                          - url: "https://my-shop.com/images/similar-1.jpg"
                            prohibitedContent: "NONE"
                        created: "2024-01-01T10:00:00Z"
                        updated: "2024-01-01T12:00:00Z"
                empty:
                  summary: No similar products found
                  value: []
        "202":
          description: |
            Accepted - Product embedding not yet computed.
            The text embedding for this product has not been generated yet (typically for products less than 24 hours old).
            Embeddings are computed during nightly batch processing.
            Poll the endpoint again later using the Location header.
          headers:
            Location:
              description: URL to poll for similar products once embeddings are computed
              schema:
                type: string
                format: uri
              example: "https://api.aura-historia.com/api/v1/shops/550e8400-e29b-41d4-a716-446655440000/products/6ba7b810/similar"
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopId"
                      sourceType: "path"
                missing_shops_product_id:
                  summary: Missing shop's product ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopsProductId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid UUID format for shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "shopId"
                      sourceType: "path"
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "PRODUCT_NOT_FOUND"
                detail: "Product with ShopId '550e8400-e29b-41d4-a716-446655440000' and ShopsProductId '6ba7b810' not found."
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/products:
    put:
      summary: Bulk create or update products
      description: |
        Creates or updates multiple products in a single batch request.
        This endpoint accepts a collection of product data and processes them asynchronously.

        **Shop Enrichment**: The shop information (shopId and shopName) is automatically
        enriched based on the product's URL. The domain is extracted from the product URL
        and must match a shop that is already registered in the system. If the shop is not
        found, the product will fail with a SHOP_NOT_FOUND error. If the URL does not contain
        a valid extractable domain, the product will fail with a NO_DOMAIN error.

        **Response Structure**:
        - `skipped`: Number of products that had no changes and were skipped
        - `unprocessed`: URLs of products that could not be processed due to temporary issues (can be retried)
        - `failed`: Map of product URLs to error codes for products that permanently failed processing

        Returns information about any products that could not be processed or failed during enrichment.
      operationId: putProducts
      tags:
        - Products
      requestBody:
        required: true
        description: Collection of products to create or update
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PutProductsCollectionData"
            example:
              items:
                - shopsProductId: "6ba7b810"
                  title:
                    text: "Smartphone Case Premium"
                    language: "en"
                  description:
                    text: "Premium quality smartphone case with wireless charging support"
                    language: "en"
                  price:
                    currency: "EUR"
                    amount: 2999
                  priceEstimateMin:
                    currency: "EUR"
                    amount: 2500
                  priceEstimateMax:
                    currency: "EUR"
                    amount: 3500
                  state: "AVAILABLE"
                  url: "https://tech-store.com/premium-case"
                  images:
                    - url: "https://tech-store.com/images/premium-case-1.jpg"
                      prohibitedContent: "NONE"
                    - url: "https://tech-store.com/images/premium-case-2.jpg"
                      prohibitedContent: "NONE"
                - shopsProductId: "7cb8c920-9dad-11d1-80b4-00c04fd430c9"
                  title:
                    text: "Basic Phone Case"
                    language: "en"
                  state: "LISTED"
                  url: "https://tech-store.com/basic-case"
                  images: []
      responses:
        "200":
          description: Products processed successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PutProductsResponse"
              examples:
                all_processed:
                  summary: All products processed successfully
                  value:
                    unprocessed:
                    failed:
                    skipped: 0
                partial_processing_with_failures:
                  summary: Some products failed with errors
                  value:
                    failed:
                      "https://unknown-shop.com/item": "SHOP_NOT_FOUND"
                      "https://tech-store.com/expensive-item": "MONETARY_AMOUNT_OVERFLOW"
                      "https://localhost:8080/item": "NO_DOMAIN"
                    skipped: 0
                partial_processing_with_unprocessed:
                  summary: Some products could not be processed (temporary issue)
                  value:
                    unprocessed:
                      - "https://tech-store.com/item-1"
                      - "https://tech-store.com/item-2"
                    failed:
                    skipped: 2
        "400":
          description: Bad request - invalid request body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/products/search:
    post:
      summary: Complex product search
      description: |
        Performs an advanced search for products using a comprehensive search filter.
        This endpoint accepts a ProductSearchData object in the request body,
        allowing for complex filtering by multiple criteria simultaneously.
        Returns a paginated collection of products matching the search criteria.

        **Personalization**: When authenticated (via optional Authorization header), the response includes
        user-specific state for each product such as whether it's on the user's watchlist and notification preferences.
        Anonymous requests receive product data without user state.
      operationId: complexSearchProducts
      tags:
        - Products
      parameters:
        - name: sort
          in: query
          required: false
          description: Field to sort results by
          schema:
            $ref: "#/components/schemas/SortProductFieldData"
          example: price
        - name: order
          in: query
          required: false
          description: Sort order (only valid when sort is specified)
          schema:
            type: string
            enum: [asc, desc]
          example: asc
        - name: searchAfter
          in: query
          required: false
          description: |
            Cursor value for pagination (search-after pattern).
            This is a JSON value returned as `searchAfter` in the previous response.
            Use this to fetch the next page of results.
            In general you do not have to worry about determining this key. It's given with the `searchAfter` field in the preceding response if more entries are present.
            This can be ANY heterogeneous array.
          schema:
            type: array
            items: {}
          example: '[2999, "6ba7b810-9dad-11d1-80b4-00c04fd430c8"]'
        - name: size
          in: query
          required: false
          description: Number of products to return per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 21
          example: 21
      security:
        - BearerAuth: []
        - {}
      requestBody:
        required: true
        description: |
          Search filter configuration with all filtering criteria.
          Unlike the simple text search, this allows filtering by multiple fields,
          price ranges, product states, and date ranges.
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductSearchData"
            example:
              language: "en"
              currency: "USD"
              productQuery: "smartphone case"
              shopName: ["Tech Store", "Electronics Hub"]
              price:
                min: 1000
                max: 5000
              state: ["AVAILABLE"]
              originYear:
                min: 1742
                max: 1953
              authenticity: ["ORIGINAL"]
              condition: ["EXCELLENT"]
              provenance: ["PARTIAL"]
              restoration: ["UNKNOWN"]
              created:
                min: "2024-01-01T00:00:00Z"
                max: "2024-12-31T23:59:59Z"
      responses:
        "200":
          description: Complex search results returned successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonalizedProductSearchResultData"
              examples:
                authenticated:
                  summary: Authenticated user response with user state for each product
                  value:
                    items:
                      - item:
                          productId: "550e8400-e29b-41d4-a716-446655440000"
                          productSlugId: "premium-smartphone-case-a1b2c3"
                          shopSlugId: "tech-store"
                          eventId: "550e8400-e29b-41d4-a716-446655440001"
                          shopId: "550e8400-e29b-41d4-a716-446655440000"
                          shopsProductId: "6ba7b810"
                          shopName: "Tech Store"
                          shopType: "COMMERCIAL_DEALER"
                          title:
                            text: "Premium Smartphone Case"
                            language: "en"
                          price:
                            currency: "USD"
                            amount: 2999
                          state: "AVAILABLE"
                          url: "https://tech-store.com/premium-case"
                          images:
                            - url: "https://tech-store.com/images/premium-case-1.jpg"
                              prohibitedContent: "NONE"
                          created: "2024-01-15T10:00:00Z"
                          updated: "2024-01-15T12:00:00Z"
                        userState:
                          watchlist:
                            watching: true
                            notifications: false
                    size: 21
                    total: 84
                    searchAfter: '[2999, "550e8400-e29b-41d4-a716-446655440000"]'
                anonymous:
                  summary: Anonymous user response without user state
                  value:
                    items:
                      - item:
                          productId: "550e8400-e29b-41d4-a716-446655440000"
                          productSlugId: "premium-smartphone-case-a1b2c3"
                          shopSlugId: "tech-store"
                          eventId: "550e8400-e29b-41d4-a716-446655440001"
                          shopId: "550e8400-e29b-41d4-a716-446655440000"
                          shopsProductId: "6ba7b810"
                          shopName: "Tech Store"
                          shopType: "COMMERCIAL_DEALER"
                          title:
                            text: "Premium Smartphone Case"
                            language: "en"
                          price:
                            currency: "USD"
                            amount: 2999
                          state: "AVAILABLE"
                          url: "https://tech-store.com/premium-case"
                          images:
                            - url: "https://tech-store.com/images/premium-case-1.jpg"
                              prohibitedContent: "NONE"
                          created: "2024-01-15T10:00:00Z"
                          updated: "2024-01-15T12:00:00Z"
                    size: 21
                    total: 84
                    searchAfter: '[2999, "550e8400-e29b-41d4-a716-446655440000"]'
        "400":
          description: Bad request - invalid parameters or body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
                invalid_product_query:
                  summary: Invalid product query length
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "productQuery must be at least 3 characters long"
                invalid_sort_field:
                  summary: Invalid sort field
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "sort"
                      sourceType: "query"
                    detail: "Expected any of: 'score', 'price', 'updated', 'created'. Got: 'invalid'"
                invalid_order:
                  summary: Invalid sort order
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "order"
                      sourceType: "query"
                    detail: "Expected any of: 'asc' or 'desc'. Got: 'invalid'"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/me/search-filters:
    get:
      summary: List user search filters
      description: |
        Retrieves all search filters for the authenticated user.
        Results can be optionally sorted by creation date.
        Requires valid Cognito JWT authentication.
      operationId: getUserSearchFilters
      tags:
        - Search Filters
      parameters:
        - name: sort
          in: query
          required: false
          description: Field to sort results by
          schema:
            $ref: "#/components/schemas/SortUserSearchFilterFieldData"
          example: created
        - name: order
          in: query
          required: false
          description: Sort order (only valid when sort is specified)
          schema:
            type: string
            enum: [asc, desc]
            default: asc
          example: desc
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Search filters retrieved successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSearchFilterCollectionData"
              example:
                items:
                  - userId: "550e8400-e29b-41d4-a716-446655440000"
                    userSearchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                    name: "My Tech Store Search"
                    productSearch:
                      language: "en"
                      currency: "USD"
                      productQuery: "smartphone"
                      shopName: ["Tech Store"]
                      price:
                        min: 1000
                        max: 5000
                      state: ["AVAILABLE"]
                    created: "2024-01-01T10:00:00Z"
                    updated: "2024-01-01T12:00:00Z"
                from: 0
                size: 1
                total: 1
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                invalid_sort_field:
                  summary: Invalid sort field
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "sort"
                      sourceType: "query"
                    detail: "Expected any of: 'created'. Got: 'invalid'"
                invalid_order:
                  summary: Invalid sort order
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "order"
                      sourceType: "query"
                    detail: "Expected any of: 'asc' or 'desc'. Got: 'invalid'"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
    post:
      summary: Create a new search filter
      description: |
        Creates a new search filter for the authenticated user.
        The search filter configuration is provided in the request body.
        Returns the created search filter with generated ID and metadata.
        Requires valid Cognito JWT authentication.
      operationId: createUserSearchFilter
      tags:
        - Search Filters
      security:
        - BearerAuth: []
      requestBody:
        required: true
        description: Search filter configuration with name and filter criteria
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostUserSearchFilterData"
            example:
              name: "My Tech Store Search"
              productSearch:
                language: "en"
                currency: "USD"
                productQuery: "smartphone"
                shopName: ["Tech Store"]
                price:
                  min: 1000
                  max: 5000
                state: ["AVAILABLE"]
                created:
                  min: "2024-01-01T00:00:00Z"
                  max: "2024-12-31T23:59:59Z"
      responses:
        "201":
          description: Search filter created successfully
          headers:
            Location:
              description: URL of the created search filter
              schema:
                type: string
                format: uri
              example: "https://api.aura-historia.com/api/v1/me/search-filters/6ba7b810-9dad-11d1-80b4-00c04fd430c8"
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: "#/components/schemas/LanguageData"
              example: "en"
            Last-Modified:
              description: When the search filter was created/updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSearchFilterData"
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                userSearchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                name: "My Tech Store Search"
                productSearch:
                  language: "en"
                  currency: "USD"
                  productQuery: "smartphone"
                  shopName: ["Tech Store"]
                  price:
                    min: 1000
                    max: 5000
                  state: ["AVAILABLE"]
                created: "2024-01-01T12:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        "400":
          description: Bad request - invalid request body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
                invalid_product_query:
                  summary: Invalid product query
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "productQuery must be at least 3 characters long"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/me/search-filters/{userSearchFilterId}:
    get:
      summary: Get a specific search filter
      description: |
        Retrieves a specific search filter by its ID for the authenticated user.
        Returns the complete search filter configuration and metadata.
        Requires valid Cognito JWT authentication.
      operationId: getUserSearchFilter
      tags:
        - Search Filters
      parameters:
        - name: userSearchFilterId
          in: path
          required: true
          description: Unique identifier of the search filter
          schema:
            type: string
            format: uuid
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Search filter found and returned successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: "#/components/schemas/LanguageData"
              example: "en"
            Last-Modified:
              description: When the search filter was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSearchFilterData"
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                userSearchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                name: "My Tech Store Search"
                productSearch:
                  language: "en"
                  currency: "USD"
                  productQuery: "smartphone"
                  shopName: ["Tech Store"]
                  price:
                    min: 1000
                    max: 5000
                  state: ["AVAILABLE"]
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_search_filter_id:
                  summary: Missing search filter ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "userSearchFilterId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid search filter ID format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "userSearchFilterId"
                      sourceType: "path"
                    detail: "Invalid UUID format"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "404":
          description: Search filter not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SEARCH_FILTER_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
    delete:
      summary: Delete a search filter
      description: |
        Deletes a specific search filter by its ID for the authenticated user.
        The search filter must exist and belong to the authenticated user.
        Requires valid Cognito JWT authentication.
      operationId: deleteUserSearchFilter
      tags:
        - Search Filters
      parameters:
        - name: userSearchFilterId
          in: path
          required: true
          description: Unique identifier of the search filter to delete
          schema:
            type: string
            format: uuid
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
      security:
        - BearerAuth: []
      responses:
        "204":
          description: Search filter deleted successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_search_filter_id:
                  summary: Missing search filter ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "userSearchFilterId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid search filter ID format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "userSearchFilterId"
                      sourceType: "path"
                    detail: "Invalid UUID format"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "404":
          description: Search filter not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SEARCH_FILTER_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
    patch:
      summary: Update a search filter
      description: |
        Updates a specific search filter by its ID for the authenticated user.
        Allows partial updates - only provided fields will be modified.
        If no fields are provided in the request body, returns the existing search filter unchanged.
        Requires valid Cognito JWT authentication.
      operationId: updateUserSearchFilter
      tags:
        - Search Filters
      parameters:
        - name: userSearchFilterId
          in: path
          required: true
          description: Unique identifier of the search filter to update
          schema:
            type: string
            format: uuid
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
      security:
        - BearerAuth: []
      requestBody:
        required: false
        description: |
          Partial search filter update data.
          Only provided fields will be updated. If body is empty, returns existing filter.
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchUserSearchFilterData"
            examples:
              partial_update:
                summary: Update specific fields
                value:
                  name: "Updated Filter Name"
                  productSearch:
                    shopName: ["Updated Store"]
                    price:
                      min: 2000
                      max: 8000
              update_name_only:
                summary: Update only the name
                value:
                  name: "New Filter Name"
              update_filter_only:
                summary: Update only the filter criteria
                value:
                  productSearch:
                    language: "de"
                    currency: "EUR"
              empty_update:
                summary: No changes (returns existing filter)
                value: {}
      responses:
        "200":
          description: Search filter updated successfully
          headers:
            Content-Language:
              description: The language of the returned content
              schema:
                $ref: "#/components/schemas/LanguageData"
              example: "en"
            Last-Modified:
              description: When the search filter was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:30:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSearchFilterData"
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                userSearchFilterId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                name: "Updated Filter Name"
                productSearch:
                  language: "en"
                  currency: "USD"
                  productQuery: "smartphone"
                  shopName: ["Updated Store"]
                  price:
                    min: 2000
                    max: 8000
                  state: ["AVAILABLE"]
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:30:00Z"
        "400":
          description: Bad request - invalid parameters or body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_search_filter_id:
                  summary: Missing search filter ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "userSearchFilterId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid search filter ID format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "userSearchFilterId"
                      sourceType: "path"
                    detail: "Invalid UUID format"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
                invalid_product_query:
                  summary: Invalid product query length
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "productQuery must be at least 3 characters long"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "404":
          description: Search filter not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SEARCH_FILTER_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/me/watchlist:
    get:
      summary: List user's watchlist products
      description: |
        Retrieves all products in the authenticated user's watchlist.
        Results are paginated using search-after cursor-based pagination with timestamp.
        Requires valid Cognito JWT authentication.
      operationId: getWatchlistProducts
      tags:
        - Watchlist
      parameters:
        - name: currency
          in: query
          required: false
          description: Currency for price display
          schema:
            $ref: "#/components/schemas/CurrencyData"
          example: EUR
        - name: sort
          in: query
          required: false
          description: Field to sort results by
          schema:
            $ref: "#/components/schemas/SortWatchlistProductFieldData"
          example: created
        - name: order
          in: query
          required: false
          description: Sort order (only valid when sort is specified)
          schema:
            type: string
            enum: [asc, desc]
          example: desc
        - name: searchAfter
          in: query
          required: false
          description: |
            RFC3339 timestamp for cursor-based pagination (search-after).
            Depending on sort-order, returns watchlist-products created, either after this timestamp for asc (oldest first) or before this timestamp for desc (latest first).
            In general you do not have to worry about determining this key. It's given with `searchAfter` in the preceding response if more entries are present.
          schema:
            type: string
            format: date-time
          example: "2024-01-01T10:00:00Z"
        - name: size
          in: query
          required: false
          description: Number of products to return per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 21
          example: 21
        - name: Accept-Language
          in: header
          required: false
          description: |
            Preferred language for localized content.
            Supports quality values and multiple languages.
            Supported languages: de, en, fr, es (with regional variants).
          schema:
            type: string
            pattern: '^([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)(,([a-z]{2}(-[A-Z]{2})?(;q=[0-9](\.[0-9])?)?)*)*$'
          examples:
            single:
              value: "de"
              description: "German"
            multiple:
              value: "en;q=0.9,de;q=0.8"
              description: "English preferred, German as fallback"
            regional:
              value: "en-US"
              description: "US English"
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Watchlist products retrieved successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WatchlistCollectionData"
              example:
                items:
                  - item:
                      productId: "550e8400-e29b-41d4-a716-446655440000"
                      eventId: "550e8400-e29b-41d4-a716-446655440001"
                      shopId: "550e8400-e29b-41d4-a716-446655440000"
                      shopsProductId: "6ba7b810"
                      shopName: "Tech Store"
                      title:
                        text: "Smartphone Case"
                        language: "en"
                      price:
                        currency: "EUR"
                        amount: 2999
                      priceEstimateMin:
                        currency: "EUR"
                        amount: 2700
                      priceEstimateMax:
                        currency: "EUR"
                        amount: 3300
                      state: "AVAILABLE"
                      url: "https://tech-store.com/smartphone-case"
                      images:
                        - url: "https://tech-store.com/images/case-1.jpg"
                          prohibitedContent: "NONE"
                      created: "2024-01-01T10:00:00Z"
                      updated: "2024-01-01T12:00:00Z"
                    created: "2024-01-15T08:00:00Z"
                size: 21
                searchAfter: "2024-01-15T08:00:00Z"
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                invalid_sort_field:
                  summary: Invalid sort field
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "sort"
                      sourceType: "query"
                    detail: "Expected any of: 'created'. Got: 'invalid'"
                invalid_order:
                  summary: Invalid sort order
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "order"
                      sourceType: "query"
                    detail: "Expected any of: 'asc' or 'desc'. Got: 'invalid'"
                invalid_from_timestamp:
                  summary: Invalid from timestamp
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_RFC3339_TIMESTAMP"
                    source:
                      field: "from"
                      sourceType: "query"
                    detail: "Invalid RFC3339 timestamp format"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
    post:
      summary: Add product to watchlist
      description: |
        Adds a product to the authenticated user's watchlist.
        The request body must contain the shop ID and shop's product ID.
        Each user is limited to a maximum of 5 watchlist products. If the user already has 5 products
        in their watchlist, adding another will result in a 422 Unprocessable Entity error.
        Returns a 201 Created response with a Location header pointing to the created resource.
        Requires valid Cognito JWT authentication.
      operationId: addWatchlistProduct
      tags:
        - Watchlist
      security:
        - BearerAuth: []
      requestBody:
        required: true
        description: Product identifier to add to watchlist
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductKeyData"
            example:
              shopId: "550e8400-e29b-41d4-a716-446655440000"
              shopsProductId: "6ba7b810"
      responses:
        "201":
          description: Product added to watchlist successfully
          headers:
            Location:
              description: URL of the added watchlist product
              schema:
                type: string
                format: uri
              example: "https://api.aura-historia.com/api/v1/me/watchlist/550e8400-e29b-41d4-a716-446655440000/6ba7b810-9dad-11d1-80b4-00c04fd430c8"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WatchlistProductPatchResponse"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopsProductId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                productId: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                notifications: false
                created: "2024-01-15T08:00:00Z"
                updated: "2024-01-15T08:00:00Z"
        "400":
          description: Bad request - invalid request body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "422":
          description: Unprocessable Entity - watchlist quota exceeded
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 422
                title: "Unprocessable Content"
                error: "WATCHLIST_QUOTA_EXCEEDED"
                detail: "Exceeded the maximum amount of watchlist entries. There are already 5/5 watchlist entries occupied."
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/me/account:
    get:
      summary: Get user account data
      description: |
        Retrieves the authenticated user's account information including email, name, language, and currency preferences.
        Requires valid Cognito JWT authentication.
      operationId: getUserAccount
      tags:
        - User Account
      security:
        - BearerAuth: []
      responses:
        "200":
          description: User account data retrieved successfully
          headers:
            Last-Modified:
              description: When the user account was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserAccountData"
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                email: "user@example.com"
                firstName: "John"
                lastName: "Doe"
                language: "en"
                currency: "EUR"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "404":
          description: User not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "USER_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
    patch:
      summary: Update user account data
      description: |
        Updates the authenticated user's account information.
        All fields in the request body are optional - only provided fields will be updated.
        Returns the updated user account data.
        Requires valid Cognito JWT authentication.
      operationId: updateUserAccount
      tags:
        - User Account
      security:
        - BearerAuth: []
      requestBody:
        required: true
        description: |
          Partial user account update data.
          All fields are optional - only provided fields will be updated.
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchUserAccountData"
            examples:
              update_all:
                summary: Update all fields
                value:
                  firstName: "Jane"
                  lastName: "Smith"
                  language: "de"
                  currency: "USD"
              update_name_only:
                summary: Update name only
                value:
                  firstName: "Jane"
                  lastName: "Smith"
              update_preferences_only:
                summary: Update language and currency only
                value:
                  language: "fr"
                  currency: "GBP"
      responses:
        "200":
          description: User account updated successfully
          headers:
            Last-Modified:
              description: When the user account was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:30:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserAccountData"
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                email: "jane.smith@example.com"
                firstName: "Jane"
                lastName: "Smith"
                language: "de"
                currency: "USD"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:30:00Z"
        "400":
          description: Bad request - invalid request body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "404":
          description: User not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "USER_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/me/watchlist/{shopId}/{shopsProductId}:
    delete:
      summary: Remove product from watchlist
      description: |
        Removes a specific product from the authenticated user's watchlist.
        Returns a 204 No Content response on success.
        Requires valid Cognito JWT authentication.
      operationId: deleteWatchlistProduct
      tags:
        - Watchlist
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        - name: shopsProductId
          in: path
          required: true
          description: Shop's unique identifier for the product
          schema:
            type: string
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
      security:
        - BearerAuth: []
      responses:
        "204":
          description: Product removed from watchlist successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
        "400":
          description: Bad request - invalid parameters
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopId"
                      sourceType: "path"
                missing_shops_product_id:
                  summary: Missing shop's product ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopsProductId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid shop ID format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "shopId"
                      sourceType: "path"
                    detail: "Invalid UUID format"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "404":
          description: Watchlist entry not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "WATCHLIST_ENTRY_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

    patch:
      summary: Update watchlist product settings
      description: |
        Updates settings for a specific watchlist product (e.g., toggle notifications).
        Returns the updated watchlist product data with core identifiers and settings.
        Requires valid Cognito JWT authentication.
      operationId: patchWatchlistProduct
      tags:
        - Watchlist
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        - name: shopsProductId
          in: path
          required: true
          description: Shop's unique identifier for the product
          schema:
            type: string
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
      security:
        - BearerAuth: []
      requestBody:
        required: true
        description: Patch object containing fields to update
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WatchlistProductPatch"
            examples:
              enable_notifications:
                summary: Enable notifications
                value:
                  notifications: true
              disable_notifications:
                summary: Disable notifications
                value:
                  notifications: false
      responses:
        "200":
          description: Watchlist product updated successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
            Last-Modified:
              description: When the watchlist product was last updated
              schema:
                type: string
                format: date-time
              example: "2024-01-15T08:30:00Z"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WatchlistProductPatchResponse"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopsProductId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                productId: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                notifications: true
                created: "2024-01-15T08:00:00Z"
                updated: "2024-01-15T08:30:00Z"
        "400":
          description: Bad request - invalid parameters or body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopId"
                      sourceType: "path"
                missing_shops_product_id:
                  summary: Missing shop's product ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopsProductId"
                      sourceType: "path"
                invalid_uuid:
                  summary: Invalid shop ID format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "shopId"
                      sourceType: "path"
                    detail: "Invalid UUID format"
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_body:
                  summary: Invalid request body format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
        "401":
          description: Unauthorized - invalid or missing JWT token
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 401
                title: "Unauthorized"
                error: "UNAUTHORIZED"
        "404":
          description: Watchlist entry not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "WATCHLIST_ENTRY_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/shops:
    post:
      summary: Create a new shop
      description: |
        Creates a new shop in the system with the provided details.
        The shop must include at least one domain and can have up to 100 domains.
        Returns the created shop with generated ID and timestamps.
        
        **Uniqueness Checks**:
        - The shop name must be unique (via slug normalization). A slug is automatically generated from the shop name.
        - All shop domains must be unique - no domain can be associated with multiple shops.
        
        If either uniqueness constraint is violated, a 409 Conflict error is returned.
      operationId: createShop
      tags:
        - Shops
      requestBody:
        required: true
        description: Shop data for creating a new shop
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostShopData"
            example:
              name: "Tech Store Premium"
              domains:
                - "tech-store-premium.com"
                - "tech-store-premium.de"
                - "apple.tech-store-premium.com"
              image: "https://tech-store-premium.com/logo.svg"
      responses:
        "201":
          description: Shop created successfully
          headers:
            Location:
              description: URL of the created shop
              schema:
                type: string
                format: uri
              example: "https://api.aura-historia.com/api/v1/shops/550e8400-e29b-41d4-a716-446655440000"
            Last-Modified:
              description: When the shop was created/updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetShopData"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopSlugId: "tech-store-premium"
                name: "Tech Store Premium"
                shopType: "COMMERCIAL_DEALER"
                domains:
                  - "tech-store-premium.com"
                  - "tech-store-premium.de"
                  - "apple.tech-store-premium.com"
                image: "https://tech-store-premium.com/logo.svg"
                created: "2024-01-01T12:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        "400":
          description: Bad request - invalid request body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
                too_many_domains:
                  summary: Too many domains provided
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "SHOP_TOO_MANY_DOMAINS"
                    detail: "Shop can only have 100 domains but was given more: '142'"
        "409":
          description: Conflict - shop with this name/slug or domain already exists
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                shop_slug_exists:
                  summary: Shop slug already exists
                  value:
                    status: 409
                    title: "Conflict"
                    error: "SHOP_EXISTS_ALREADY"
                    detail: "Shop with name 'Tech Store Premium' exists already - the shop-slug 'tech-store-premium' is already registered."
                shop_domain_exists:
                  summary: Shop domain already exists
                  value:
                    status: 409
                    title: "Conflict"
                    error: "SHOP_EXISTS_ALREADY"
                    detail: "Shop with name 'Tech Store Premium' exists already - a domain of the shop is already registered."
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
        "503":
          description: Service temporarily unavailable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 503
                title: "Service Unavailable"
                error: "UNPROCESSED_ITEMS"
                detail: "Did not succeed checking existence of shop due to DynamoDB Batch-Response containing unprocessed items"

  /api/v1/shops/{shopId}:
    get:
      summary: Get shop details by ID
      description: |
        Retrieves detailed information about a specific shop by its shop ID (UUID).
        Returns complete shop metadata including name, domains, image, and timestamps.
      operationId: getShopById
      tags:
        - Shops
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop (UUID format)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: Shop found and returned successfully
          headers:
            Last-Modified:
              description: When the shop was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetShopData"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopSlugId: "tech-store-premium"
                name: "Tech Store Premium"
                shopType: "COMMERCIAL_DEALER"
                domains:
                  [
                    "tech-store-premium.com",
                    "tech-store-premium.de",
                    "apple.tech-store-premium.com",
                  ]
                image: "https://tech-store-premium.com/logo.svg"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        "400":
          description: Bad request - invalid or missing shop ID
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopId"
                      sourceType: "path"
                    detail: "Missing field 'shopId'."
                invalid_shop_id:
                  summary: Invalid shop ID format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "shopId"
                      sourceType: "path"
                    detail: "Invalid UUID format"
        "404":
          description: Shop not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SHOP_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
    patch:
      summary: Update shop details by ID
      description: |
        Updates an existing shop's information by its shop ID (UUID).
        All fields in the request body are optional - only provided fields will be updated.
        If the request body is empty or only contains null values, the shop is returned unchanged.
        When updating domains, the complete new set of domains must be provided.
        
        **Note**: The shop name cannot be updated as it determines the shop's slug identifier.
      operationId: updateShopById
      tags:
        - Shops
      parameters:
        - name: shopId
          in: path
          required: true
          description: Unique identifier of the shop to update (UUID format)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        description: |
          Partial shop update data.
          Only provided fields will be updated. All fields are optional.
          The shop name cannot be updated.
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchShopData"
            examples:
              update_shop_type:
                summary: Update shop type
                value:
                  shopType: "AUCTION_HOUSE"
              update_domains:
                summary: Update domains
                value:
                  domains:
                    - "tech-store-premium.com"
                    - "tech-store-premium.eu"
              update_image:
                summary: Update image
                value:
                  image: "https://tech-store-premium.com/new-logo.svg"
              update_multiple:
                summary: Update multiple fields
                value:
                  shopType: "COMMERCIAL_DEALER"
                  domains:
                    - "tech-store-premium.com"
                    - "tech-store-premium.eu"
                  image: "https://tech-store-premium.com/new-logo.svg"
      responses:
        "200":
          description: Shop updated successfully
          headers:
            Last-Modified:
              description: When the shop was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:30:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetShopData"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopSlugId: "tech-store-premium"
                name: "Tech Store Premium"
                shopType: "COMMERCIAL_DEALER"
                domains:
                  - "tech-store-premium.com"
                  - "tech-store-premium.eu"
                image: "https://tech-store-premium.com/new-logo.svg"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:30:00Z"
        "400":
          description: Bad request - invalid parameters or body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_id:
                  summary: Missing shop ID
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopId"
                      sourceType: "path"
                    detail: "Missing field 'shopId'."
                invalid_shop_id:
                  summary: Invalid shop ID format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_UUID"
                    source:
                      field: "shopId"
                      sourceType: "path"
                    detail: "Invalid UUID format"
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
                too_many_domains:
                  summary: Too many domains provided
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "SHOP_TOO_MANY_DOMAINS"
                    detail: "Shop can only have 100 domains but was given more: '142'"
        "404":
          description: Shop not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SHOP_NOT_FOUND"
                detail: "Shop with identifier not found"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
        "503":
          description: Service temporarily unavailable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 503
                title: "Service Unavailable"
                error: "UNPROCESSED_ITEMS"
                detail: "Did not succeed checking existence of shop due to DynamoDB Batch-Response containing unprocessed items"
  /api/v1/by-domain/shops/{shopDomain}:
    get:
      summary: Get shop details by domain
      description: |
        Retrieves detailed information about a specific shop by its domain.
        Returns complete shop metadata including name, domains, image, and timestamps.
      operationId: getShopByDomain
      tags:
        - Shops
      parameters:
        - name: shopDomain
          in: path
          required: true
          description: |
            Domain associated with the shop (e.g., "tech-store.com", "shop.example.com").
            The domain is normalized (lowercased, www prefix removed).
          schema:
            type: string
            pattern: '^[a-z0-9]+([-.][a-z0-9]+)*\.[a-z]{2,}$'
            example: "tech-store-premium.com"
      responses:
        "200":
          description: Shop found and returned successfully
          headers:
            Last-Modified:
              description: When the shop was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetShopData"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopSlugId: "tech-store-premium"
                name: "Tech Store Premium"
                shopType: "COMMERCIAL_DEALER"
                domains:
                  [
                    "tech-store-premium.com",
                    "tech-store-premium.de",
                    "apple.tech-store-premium.com",
                  ]
                image: "https://tech-store-premium.com/logo.svg"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        "400":
          description: Bad request - invalid or missing domain
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_domain:
                  summary: Missing shop domain
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopDomain"
                      sourceType: "path"
                    detail: "Missing field 'shopDomain'."
                invalid_domain:
                  summary: Invalid domain format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_DOMAIN"
                    source:
                      field: "shopDomain"
                      sourceType: "path"
                    detail: "Invalid domain format"
        "404":
          description: Shop not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SHOP_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
    patch:
      summary: Update shop details by domain
      description: |
        Updates an existing shop's information by its domain.
        All fields in the request body are optional - only provided fields will be updated.
        If the request body is empty or only contains null values, the shop is returned unchanged.
        When updating domains, the complete new set of domains must be provided.
        
        **Note**: The shop name cannot be updated as it determines the shop's slug identifier.
      operationId: updateShopByDomain
      tags:
        - Shops
      parameters:
        - name: shopDomain
          in: path
          required: true
          description: |
            Domain associated with the shop to update (e.g., "tech-store.com", "shop.example.com").
            The domain is normalized (lowercased, www prefix removed).
          schema:
            type: string
            pattern: '^[a-z0-9]+([-.][a-z0-9]+)*\.[a-z]{2,}$'
            example: "tech-store-premium.com"
      requestBody:
        required: true
        description: |
          Partial shop update data.
          Only provided fields will be updated. All fields are optional.
          The shop name cannot be updated.
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchShopData"
            examples:
              update_shop_type:
                summary: Update shop type
                value:
                  shopType: "AUCTION_HOUSE"
              update_domains:
                summary: Update domains
                value:
                  domains:
                    - "tech-store-premium.com"
                    - "tech-store-premium.eu"
              update_image:
                summary: Update image
                value:
                  image: "https://tech-store-premium.com/new-logo.svg"
              update_multiple:
                summary: Update multiple fields
                value:
                  shopType: "COMMERCIAL_DEALER"
                  domains:
                    - "tech-store-premium.com"
                    - "tech-store-premium.eu"
                  image: "https://tech-store-premium.com/new-logo.svg"
      responses:
        "200":
          description: Shop updated successfully
          headers:
            Last-Modified:
              description: When the shop was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:30:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetShopData"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopSlugId: "tech-store-premium"
                name: "Tech Store Premium"
                shopType: "COMMERCIAL_DEALER"
                domains:
                  - "tech-store-premium.com"
                  - "tech-store-premium.eu"
                image: "https://tech-store-premium.com/new-logo.svg"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:30:00Z"
        "400":
          description: Bad request - invalid parameters or body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_domain:
                  summary: Missing shop domain
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopDomain"
                      sourceType: "path"
                    detail: "Missing field 'shopDomain'."
                invalid_domain:
                  summary: Invalid domain format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "INVALID_DOMAIN"
                    source:
                      field: "shopDomain"
                      sourceType: "path"
                    detail: "Invalid domain format"
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
                too_many_domains:
                  summary: Too many domains provided
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "SHOP_TOO_MANY_DOMAINS"
                    detail: "Shop can only have 100 domains but was given more: '142'"
        "404":
          description: Shop not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SHOP_NOT_FOUND"
                detail: "Shop with identifier not found"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"
        "503":
          description: Service temporarily unavailable
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 503
                title: "Service Unavailable"
                error: "UNPROCESSED_ITEMS"
                detail: "Did not succeed checking existence of shop due to DynamoDB Batch-Response containing unprocessed items"

  /api/v1/by-slug/shops/{shopSlugId}:
    get:
      summary: Get shop details by slug
      description: |
        Retrieves detailed information about a specific shop by its human-readable slug identifier.
        Returns complete shop metadata including name, domains, image, and timestamps.

        **Human-Readable Identifiers**: This endpoint uses slug-based identifiers which are human-readable
        kebab-case strings derived from the shop name (e.g., "tech-store-premium" or "christies").
      operationId: getShopBySlug
      tags:
        - Shops
      parameters:
        - name: shopSlugId
          in: path
          required: true
          description: Human-readable slug identifier of the shop (kebab-case, derived from shop name)
          schema:
            type: string
            pattern: '^[a-z0-9]+(-[a-z0-9]+)*$'
          examples:
            simple:
              value: "christies"
              summary: "Simple shop slug"
            complex:
              value: "tech-store-premium"
              summary: "Multi-word shop slug"
      responses:
        "200":
          description: Shop found and returned successfully
          headers:
            Last-Modified:
              description: When the shop was last updated
              schema:
                type: string
                format: http-date
              example: "Wed, 01 Jan 2024 12:00:00 GMT"
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetShopData"
              example:
                shopId: "550e8400-e29b-41d4-a716-446655440000"
                shopSlugId: "tech-store-premium"
                name: "Tech Store Premium"
                shopType: "COMMERCIAL_DEALER"
                domains:
                  [
                    "tech-store-premium.com",
                    "tech-store-premium.de",
                    "apple.tech-store-premium.com",
                  ]
                image: "https://tech-store-premium.com/logo.svg"
                created: "2024-01-01T10:00:00Z"
                updated: "2024-01-01T12:00:00Z"
        "400":
          description: Bad request - invalid or missing shop slug identifier
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_shop_slug_id:
                  summary: Missing shop slug identifier
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_PATH_PARAMETER_VALUE"
                    source:
                      field: "shopSlugId"
                      sourceType: "path"
                    detail: "Missing field 'shopSlugId'."
        "404":
          description: Shop not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 404
                title: "Not Found"
                error: "SHOP_NOT_FOUND"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

  /api/v1/shops/search:
    post:
      summary: Search shops
      description: |
        Performs an advanced search for shops using comprehensive filtering criteria.
        This endpoint accepts a ShopSearchData object in the request body,
        allowing for complex filtering by shop name and date ranges.
        Returns a paginated collection of shops matching the search criteria.
      operationId: searchShops
      tags:
        - Shops
      parameters:
        - name: sort
          in: query
          required: false
          description: Field to sort results by
          schema:
            $ref: "#/components/schemas/SortShopFieldData"
          example: name
        - name: order
          in: query
          required: false
          description: Sort order (only valid when sort is specified)
          schema:
            type: string
            enum: [asc, desc]
            default: asc
          example: desc
        - name: searchAfter
          in: query
          required: false
          description: |
            Cursor value for keyset pagination (search-after pattern).
            This is a JSON array value returned as `searchAfter` in the previous response.
            Use this to fetch the next page of results.
            In general you do not have to worry about determining this key. It's given with the `searchAfter` field in the preceding response if more entries are present.
            The array contains the sort field value and the shop ID as a tie-breaker: `[sortValue, shopId]`.
          schema:
            type: array
            items: {}
          example: '["Tech Store Premium", "550e8400-e29b-41d4-a716-446655440000"]'
        - name: size
          in: query
          required: false
          description: Number of shops to return per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 21
          example: 21
      requestBody:
        required: true
        description: |
          Shop search filter configuration with all filtering criteria.
          Allows filtering by shop name and creation/update date ranges.
          If you do not want to restrict the search, supply an empty JSON-Object '{}' as body.
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShopSearchData"
            example:
              shopNameQuery: "tech store"
              created:
                min: "2024-01-01T00:00:00Z"
                max: "2024-12-31T23:59:59Z"
              updated:
                min: "2024-06-01T00:00:00Z"
      responses:
        "200":
          description: Shop search results returned successfully
          headers:
            Access-Control-Allow-Origin:
              description: CORS header
              schema:
                type: string
              example: "*"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShopSearchResultData"
              example:
                items:
                  - shopId: "550e8400-e29b-41d4-a716-446655440000"
                    shopSlugId: "tech-store-premium"
                    name: "Tech Store Premium"
                    shopType: "COMMERCIAL_DEALER"
                    domains: ["tech-store-premium.com"]
                    image: "https://tech-store-premium.com/logo.svg"
                    created: "2024-01-15T10:00:00Z"
                    updated: "2024-06-15T12:00:00Z"
                  - shopId: "660f9500-f39c-42e5-b827-556766550001"
                    shopSlugId: "tech-store-basic"
                    name: "Tech Store Basic"
                    shopType: "COMMERCIAL_DEALER"
                    domains: ["tech-store-basic.com"]
                    created: "2024-02-01T08:30:00Z"
                    updated: "2024-07-01T14:20:00Z"
                size: 2
                total: 42
                searchAfter: '["Tech Store Basic", "660f9500-f39c-42e5-b827-556766550001"]'
        "400":
          description: Bad request - invalid parameters or body
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              examples:
                missing_body:
                  summary: Missing request body
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Body cannot be empty"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_BODY_VALUE"
                    detail: "Invalid JSON format"
                invalid_sort_field:
                  summary: Invalid sort field
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "sort"
                      sourceType: "query"
                    detail: "Expected any of: 'score', 'name', 'updated', 'created'. Got: 'invalid'"
                invalid_order:
                  summary: Invalid sort order
                  value:
                    status: 400
                    title: "Bad Request"
                    error: "BAD_QUERY_PARAMETER_VALUE"
                    source:
                      field: "order"
                      sourceType: "query"
                    detail: "Expected any of: 'asc' or 'desc'. Got: 'invalid'"
        "500":
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/ApiError"
              example:
                status: 500
                title: "Internal Server Error"
                error: "INTERNAL_SERVER_ERROR"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Cognito JWT token.
        The token is used for authenticating and authorizing users as well as personalizing responses.
  schemas:
    GetProductData:
      type: object
      description: Complete product information including metadata and localized content
      required:
        - productId
        - productSlugId
        - shopSlugId
        - eventId
        - shopId
        - shopsProductId
        - shopName
        - shopType
        - title
        - state
        - url
        - images
        - created
        - updated
      properties:
        productId:
          type: string
          format: uuid
          description: Unique internal identifier for the product
        productSlugId:
          type: string
          pattern: '^[a-z0-9]+(-[a-z0-9]+)*-[a-f0-9]{6}$'
          description: |
            Human-readable slug identifier for the product (kebab-case with 6-character hex suffix).
            Format: {product-title}-{6-char-hex} where the title is derived from the product name.
            Example: "amazing-product-fa87c4"
        shopSlugId:
          type: string
          pattern: '^[a-z0-9]+(-[a-z0-9]+)*$'
          description: |
            Human-readable slug identifier of the shop (kebab-case, derived from shop name).
            Example: "tech-store-premium" or "christies"
        eventId:
          type: string
          format: uuid
          description: Unique identifier for the current state/version of the product
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
        shopsProductId:
          type: string
          description: Shop's unique identifier for the product. Can be any arbitrary string.
        shopName:
          type: string
          description: Display name of the shop
        shopType:
          $ref: "#/components/schemas/ShopTypeData"
        title:
          $ref: "#/components/schemas/LocalizedTextData"
        description:
          allOf:
            - $ref: "#/components/schemas/LocalizedTextData"
          nullable: true
          description: Optional product description
        price:
          allOf:
            - $ref: "#/components/schemas/PriceData"
          nullable: true
          description: Optional product price
        priceEstimateMin:
          allOf:
            - $ref: "#/components/schemas/PriceData"
          nullable: true
          description: Optional minimum estimated price for the product
        priceEstimateMax:
          allOf:
            - $ref: "#/components/schemas/PriceData"
          nullable: true
          description: Optional maximum estimated price for the product
        state:
          $ref: "#/components/schemas/ProductStateData"
        url:
          type: string
          format: uri
          description: URL to the product on the shop's website
        images:
          type: array
          items:
            $ref: "#/components/schemas/ProductImageData"
          description: Array of product images with prohibited content classification
          default: []
        originYearMin:
          type: integer
          nullable: true
          description: |
            Lower end of the year range when the antique is estimated to have originated.
            Only present when the origin year is expressed as a range (originYear will be null).
            Can be present alone (without originYearMax) to indicate "after this year".
          example: 1900
        originYear:
          type: integer
          nullable: true
          description: |
            Exact year the antique is estimated to have originated.
            When this value is present, both originYearMin and originYearMax will be null.
          example: 1837
        originYearMax:
          type: integer
          nullable: true
          description: |
            Upper end of the year range when the antique is estimated to have originated.
            Only present when the origin year is expressed as a range (originYear will be null).
            Can be present alone (without originYearMin) to indicate "before this year".
          example: 1950
        authenticity:
          allOf:
            - $ref: "#/components/schemas/AuthenticityData"
          nullable: true
          description: Authenticity classification of the antique product
        condition:
          allOf:
            - $ref: "#/components/schemas/ConditionData"
          nullable: true
          description: Physical condition assessment of the antique product
        provenance:
          allOf:
            - $ref: "#/components/schemas/ProvenanceData"
          nullable: true
          description: Documentation trail and ownership history of the antique product
        restoration:
          allOf:
            - $ref: "#/components/schemas/RestorationData"
          nullable: true
          description: Level of restoration work performed on the antique product
        auctionStart:
          type: string
          format: date-time
          nullable: true
          description: |
            Start datetime of the auction window for this product (RFC3339 format).
            Only present for products from auction houses with scheduled auction times.
            Used to indicate when bidding begins or when the item will be auctioned.
          example: "2026-02-15T10:00:00Z"
        auctionEnd:
          type: string
          format: date-time
          nullable: true
          description: |
            End datetime of the auction window for this product (RFC3339 format).
            Only present for products from auction houses with scheduled auction times.
            Used to indicate when bidding ends or when the auction session concludes.
          example: "2026-02-15T14:00:00Z"
        created:
          type: string
          format: date-time
          description: When the product was first created (RFC3339 format)
        updated:
          type: string
          format: date-time
          description: When the product was last updated (RFC3339 format)

    GetProductSummaryData:
      type: object
      description: |
        Lightweight product summary information for use in search results and similar products listings.
        Contains essential product details without extended metadata fields like description, estimates,
        origin year details, authenticity, condition, provenance, restoration, or history.
      required:
        - productId
        - productSlugId
        - shopSlugId
        - eventId
        - shopId
        - shopsProductId
        - shopName
        - shopType
        - title
        - state
        - url
        - images
        - created
        - updated
      properties:
        productId:
          type: string
          format: uuid
          description: Unique internal identifier for the product
        productSlugId:
          type: string
          pattern: '^[a-z0-9]+(-[a-z0-9]+)*-[a-f0-9]{6}$'
          description: |
            Human-readable slug identifier for the product (kebab-case with 6-character hex suffix).
            Format: {product-title}-{6-char-hex} where the title is derived from the product name.
            Example: "amazing-product-fa87c4"
        shopSlugId:
          type: string
          pattern: '^[a-z0-9]+(-[a-z0-9]+)*$'
          description: |
            Human-readable slug identifier of the shop (kebab-case, derived from shop name).
            Example: "tech-store-premium" or "christies"
        eventId:
          type: string
          format: uuid
          description: Unique identifier for the current state/version of the product
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
        shopsProductId:
          type: string
          description: Shop's unique identifier for the product. Can be any arbitrary string.
        shopName:
          type: string
          description: Display name of the shop
        shopType:
          $ref: "#/components/schemas/ShopTypeData"
        title:
          $ref: "#/components/schemas/LocalizedTextData"
        price:
          allOf:
            - $ref: "#/components/schemas/PriceData"
          nullable: true
          description: Optional product price
        state:
          $ref: "#/components/schemas/ProductStateData"
        url:
          type: string
          format: uri
          description: URL to the product on the shop's website
        images:
          type: array
          items:
            $ref: "#/components/schemas/ProductImageData"
          description: Array of product images with prohibited content classification
          default: []
        auction:
          allOf:
            - $ref: "#/components/schemas/AuctionData"
          nullable: true
          description: |
            Optional auction time window information.
            Only present for products from auction houses with scheduled auction times.
            Contains start and/or end timestamps for the auction.
        created:
          type: string
          format: date-time
          description: When the product was first created (RFC3339 format)
        updated:
          type: string
          format: date-time
          description: When the product was last updated (RFC3339 format)

    PersonalizedGetProductData:
      type: object
      description: |
        Wrapper for product data with optional user-specific state.
        When user is authenticated, includes personalized information such as watchlist status.
        When user is anonymous, only the product data is present.
      required:
        - item
      properties:
        item:
          $ref: "#/components/schemas/GetProductData"
        userState:
          allOf:
            - $ref: "#/components/schemas/ProductUserStateData"
          nullable: true
          description: Optional user-specific state for this product (only present when authenticated)

    PersonalizedGetProductSummaryData:
      type: object
      description: |
        Wrapper for lightweight product summary data with optional user-specific state.
        Used in search results and similar products listings.
        When user is authenticated, includes personalized information such as watchlist status.
        When user is anonymous, only the product summary data is present.
      required:
        - item
      properties:
        item:
          $ref: "#/components/schemas/GetProductSummaryData"
        userState:
          allOf:
            - $ref: "#/components/schemas/ProductUserStateData"
          nullable: true
          description: Optional user-specific state for this product (only present when authenticated)

    PersonalizedProductSearchResultData:
      type: object
      description: |
        Paginated collection of personalized products using cursor-based pagination (search-after pattern).
        Each product may include user-specific state when the request is authenticated.
      required:
        - items
        - size
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/PersonalizedGetProductSummaryData"
          description: Array of personalized product summaries in the current page
        size:
          type: integer
          minimum: 0
          description: Number of products returned in the current page
          example: 21
        total:
          type: integer
          minimum: 0
          description: Total number of products matching the query (optional, may not always be available)
          nullable: true
          example: 127
        searchAfter:
          type: array
          items: {}
          description: |
            Cursor for the next page (JSON value). Present when there are more results.
            Pass this value as the `searchAfter` query parameter to get the next page.
            This can be ANY heterogeneous array.
          nullable: true
          example: '[2999, "550e8400-e29b-41d4-a716-446655440000"]'

    ProductUserStateData:
      type: object
      description: User-specific state information for a product
      required:
        - watchlist
      properties:
        watchlist:
          $ref: "#/components/schemas/WatchlistUserStateData"

    WatchlistUserStateData:
      type: object
      description: Watchlist-specific user state for a product
      required:
        - watching
        - notifications
      properties:
        watching:
          type: boolean
          description: Whether the product is on the user's watchlist
          example: true
        notifications:
          type: boolean
          description: Whether notifications are enabled for this watchlist product
          example: false

    LocalizedTextData:
      type: object
      description: Text content with language information
      required:
        - text
        - language
      properties:
        text:
          type: string
          description: The text content
        language:
          $ref: "#/components/schemas/LanguageData"

    PriceData:
      type: object
      description: Price information with currency
      required:
        - currency
        - amount
      properties:
        currency:
          $ref: "#/components/schemas/CurrencyData"
        amount:
          type: integer
          description: Price amount in minor currency units (e.g., cents for EUR/USD)
          minimum: 0
          example: 2999

    ProductCreatedEventPayloadData:
      type: object
      description: Minimal information about an product when it was created
      required:
        - state
      properties:
        state:
          $ref: "#/components/schemas/ProductStateData"
        price:
          $ref: "#/components/schemas/PriceData"
        priceEstimateMin:
          $ref: "#/components/schemas/PriceData"
        priceEstimateMax:
          $ref: "#/components/schemas/PriceData"

    ProductEventStateChangedPayloadData:
      type: object
      description: Payload for state change events, containing both old and new state
      required:
        - oldState
        - newState
      properties:
        oldState:
          $ref: "#/components/schemas/ProductStateData"
        newState:
          $ref: "#/components/schemas/ProductStateData"

    ProductEventPriceDiscoveredPayloadData:
      type: object
      description: Payload for price discovered events when a product's price is first detected
      required:
        - newPrice
      properties:
        newPrice:
          $ref: "#/components/schemas/PriceData"

    ProductEventPriceChangedPayloadData:
      type: object
      description: Payload for price change events (dropped or increased), containing both old and new price
      required:
        - oldPrice
        - newPrice
      properties:
        oldPrice:
          $ref: "#/components/schemas/PriceData"
        newPrice:
          $ref: "#/components/schemas/PriceData"

    ProductEventPriceRemovedPayloadData:
      type: object
      description: Payload for price removed events when a product's price is removed
      required:
        - oldPrice
      properties:
        oldPrice:
          $ref: "#/components/schemas/PriceData"

    GetProductEventData:
      type: object
      description: Historical event for a product
      required:
        - eventType
        - productId
        - eventId
        - shopId
        - shopsProductId
        - payload
        - timestamp
      properties:
        eventType:
          $ref: "#/components/schemas/ProductEventTypeData"
        productId:
          type: string
          format: uuid
          description: Unique internal identifier for the product
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
        shopsProductId:
          type: string
          description: Shop's unique identifier for the product. Can be any arbitrary string.
        payload:
          $ref: "#/components/schemas/ProductEventPayloadData"
        timestamp:
          type: string
          format: date-time
          description: When the event occurred (RFC3339 format)

    LanguageData:
      type: string
      enum: [de, en, fr, es]
      description: |
        Supported languages (ISO 639-1 codes):
        - de: German (includes de-DE, de-AT, de-CH, de-LU, de-LI)
        - en: English (includes en-US, en-GB, en-AU, en-CA, en-NZ, en-IE)
        - fr: French (includes fr-FR, fr-CA, fr-BE, fr-CH, fr-LU)
        - es: Spanish (includes es-ES, es-MX, es-AR, es-CO, es-CL, es-PE, es-VE)
      default: en
      example: de

    CurrencyData:
      type: string
      enum: [EUR, GBP, USD, AUD, CAD, NZD]
      description: |
        Supported currencies (ISO 4217 codes):
        - EUR: Euro
        - GBP: British Pound
        - USD: US Dollar
        - AUD: Australian Dollar
        - CAD: Canadian Dollar
        - NZD: New Zealand Dollar
      default: EUR
      example: EUR

    ProductStateData:
      type: string
      enum: [LISTED, AVAILABLE, RESERVED, SOLD, REMOVED, UNKNOWN]
      description: |
        Current state of the product:
        - LISTED: Product has been listed
        - AVAILABLE: Product is available for purchase
        - RESERVED: Product is reserved by a buyer
        - SOLD: Product has been sold
        - REMOVED: Product has been removed and can no longer be tracked
        - UNKNOWN: Product has an unknown state
      example: AVAILABLE

    AuthenticityData:
      type: string
      enum: [ORIGINAL, LATER_COPY, REPRODUCTION, QUESTIONABLE, UNKNOWN]
      description: |
        Authenticity classification of the antique product:
        - ORIGINAL: Verified original antique from the stated period
        - LATER_COPY: Antique copy made at a later time but still historical
        - REPRODUCTION: Modern reproduction or replica
        - QUESTIONABLE: Authenticity is disputed or uncertain
        - UNKNOWN: Authenticity has not been determined
      default: UNKNOWN
      example: ORIGINAL

    AuctionData:
      type: object
      description: |
        Auction time window information for products from auction houses.
        Contains optional start and end timestamps for scheduled auctions.
        At least one of the fields (start or end) must be present when this object is included.
      properties:
        start:
          type: string
          format: date-time
          nullable: true
          description: |
            Start datetime of the auction window for this product (RFC3339 format).
            Only present for products from auction houses with scheduled auction start times.
            Used to indicate when bidding begins or when the item will be auctioned.
          example: "2025-05-01T12:00:00Z"
        end:
          type: string
          format: date-time
          nullable: true
          description: |
            End datetime of the auction window for this product (RFC3339 format).
            Only present for products from auction houses with scheduled auction end times.
            Used to indicate when bidding ends or when the auction session concludes.
          example: "2025-05-10T12:00:00Z"

    ConditionData:
      type: string
      enum: [EXCELLENT, GREAT, GOOD, FAIR, POOR, UNKNOWN]
      description: |
        Physical condition assessment of the antique product:
        - EXCELLENT: Near-perfect condition with minimal wear
        - GREAT: Very good condition with minor signs of age
        - GOOD: Good condition with moderate wear consistent with age
        - FAIR: Fair condition with significant wear but structurally sound
        - POOR: Poor condition with major damage or deterioration
        - UNKNOWN: Condition has not been assessed
      default: UNKNOWN
      example: EXCELLENT

    ProvenanceData:
      type: string
      enum: [COMPLETE, PARTIAL, CLAIMED, NONE, UNKNOWN]
      description: |
        Documentation trail and ownership history of the antique product:
        - COMPLETE: Full documented history from origin to present
        - PARTIAL: Some documentation exists but history has gaps
        - CLAIMED: Provenance is claimed by seller but lacks documentation
        - NONE: No provenance documentation available
        - UNKNOWN: Provenance status has not been determined
      default: UNKNOWN
      example: PARTIAL

    RestorationData:
      type: string
      enum: [NONE, MINOR, MAJOR, UNKNOWN]
      description: |
        Level of restoration work performed on the antique product:
        - NONE: No restoration, original condition preserved
        - MINOR: Minor restoration or conservation work (cleaning, small repairs)
        - MAJOR: Significant restoration or reconstruction work
        - UNKNOWN: Restoration history has not been determined
      default: UNKNOWN
      example: NONE

    ProhibitedContentData:
      type: string
      enum: [UNKNOWN, NONE, NAZI_GERMANY]
      description: |
        Classification of prohibited or sensitive content that may be present in product images:
        - UNKNOWN: Content classification has not been determined
        - NONE: No prohibited content detected in the image
        - NAZI_GERMANY: Image contains Nazi Germany symbols, insignia, or related content
      default: UNKNOWN
      example: NONE

    ShopTypeData:
      type: string
      enum: [AUCTION_HOUSE, AUCTION_PLATFORM, COMMERCIAL_DEALER, MARKETPLACE]
      description: |
        Type of vendor or shop:
        - AUCTION_HOUSE: Auction house selling items through auctions
        - AUCTION_PLATFORM: Auction platform hosting auctions for auction-houses
        - COMMERCIAL_DEALER: Commercial dealer or shop selling items directly
        - MARKETPLACE: Marketplace platform connecting buyers and sellers
      example: COMMERCIAL_DEALER

    ProductImageData:
      type: object
      description: Product image with prohibited content classification
      required:
        - url
        - prohibitedContent
      properties:
        url:
          type: string
          format: uri
          description: URL to the product image
          example: "https://my-shop.com/images/product-1.jpg"
        prohibitedContent:
          $ref: "#/components/schemas/ProhibitedContentData"

    SortProductFieldData:
      type: string
      enum: [score, price, originYear, updated, created]
      description: |
        Fields available for sorting:
        - score: Sort by relevance score (default, only available when searching with text query)
        - price: Sort by product price
        - originYear: Sort by product origin year
        - updated: Sort by last updated timestamp
        - created: Sort by creation timestamp
      default: score
      example: price

    ProductEventTypeData:
      type: string
      enum:
        [
          CREATED,
          STATE_LISTED,
          STATE_AVAILABLE,
          STATE_RESERVED,
          STATE_SOLD,
          STATE_REMOVED,
          STATE_UNKNOWN,
          PRICE_DISCOVERED,
          PRICE_DROPPED,
          PRICE_INCREASED,
          PRICE_REMOVED,
        ]
      description: Types of events that can occur for a product
      example: STATE_AVAILABLE

    ProductEventPayloadData:
      oneOf:
        - $ref: "#/components/schemas/ProductCreatedEventPayloadData"
        - $ref: "#/components/schemas/ProductEventStateChangedPayloadData"
        - $ref: "#/components/schemas/ProductEventPriceDiscoveredPayloadData"
        - $ref: "#/components/schemas/ProductEventPriceChangedPayloadData"
        - $ref: "#/components/schemas/ProductEventPriceRemovedPayloadData"
      description: |
        Event-specific payload data. The structure varies depending on the event type:
        - CREATED: ProductCreatedEventPayloadData (initial product state and optional price)
        - STATE_LISTED, STATE_AVAILABLE, STATE_RESERVED, STATE_SOLD, STATE_REMOVED, STATE_UNKNOWN: ProductEventStateChangedPayloadData (old and new state)
        - PRICE_DISCOVERED: ProductEventPriceDiscoveredPayloadData (new price only, when price is first detected)
        - PRICE_DROPPED, PRICE_INCREASED: ProductEventPriceChangedPayloadData (old and new price)
        - PRICE_REMOVED: ProductEventPriceRemovedPayloadData (old price only, when price is removed)

    ApiError:
      type: object
      description: Standard error response format (RFC 9457)
      required:
        - status
        - title
        - error
      properties:
        status:
          type: integer
          description: HTTP status code
          example: 400
        title:
          type: string
          description: HTTP status code in human-readable form
          example: Bad Request
        error:
          type: string
          description: Error code identifier
          example: "BAD_PARAMETER"
        source:
          $ref: "#/components/schemas/ApiErrorSource"
        detail:
          type: string
          description: Human-readable error message
          example: "Expected any of: 'true' or 'false'. Got: 'invalid'"

    ApiErrorSource:
      type: object
      description: Information about the source of the error
      required:
        - field
        - sourceType
      properties:
        field:
          type: string
          description: Name of the field that caused the error
          example: "shopId"
        sourceType:
          type: string
          enum: [query, path, header, body]
          description: Type of parameter that caused the error
          example: "path"

    ProductSearchData:
      type: object
      description: Product search configuration with query parameters and filtering options
      required:
        - language
        - currency
        - productQuery
      properties:
        language:
          $ref: "#/components/schemas/LanguageData"
        currency:
          $ref: "#/components/schemas/CurrencyData"
        productQuery:
          type: string
          description: Text query for searching products (minimum 3 characters)
          minLength: 3
          example: "smartphone case"
        shopName:
          type: array
          items:
            type: string
          description: |
            Optional filter by exact shop names (keyword matching).
            Filters products to only those from shops with names exactly matching one of the provided values.
            This is an exact match filter, not a fuzzy text search.
          uniqueItems: true
          default: []
          example: ["Sotheby's", "Christie's"]
        excludeShopName:
          type: array
          items:
            type: string
          description: |
            Optional filter to exclude products from specific shop names (keyword matching).
            Products from shops with names exactly matching one of the provided values will be excluded from results.
            This is an exact match filter, not a fuzzy text search.
            Empty array means no shops are excluded.
          uniqueItems: true
          default: []
          example: ["Heritage Auctions", "Christie's"]
        shopType:
          type: array
          items:
            $ref: "#/components/schemas/ShopTypeData"
          description: Optional filter by shop types
          uniqueItems: true
          default: []
          nullable: true
          example: ["COMMERCIAL_DEALER"]
        price:
          allOf:
            - $ref: "#/components/schemas/RangeQueryUInt64"
          nullable: true
          description: Optional price range filter in minor currency units
        state:
          type: array
          items:
            $ref: "#/components/schemas/ProductStateData"
          description: Optional filter by product states
          uniqueItems: true
          default: []
          nullable: true
          example: ["AVAILABLE"]
        originYear:
          allOf:
            - $ref: "#/components/schemas/RangeQueryInt32"
          nullable: true
          description: Optional filter by product origin year range
        authenticity:
          type: array
          items:
            $ref: "#/components/schemas/AuthenticityData"
          description: Optional filter by authenticity classifications
          uniqueItems: true
          default: []
          nullable: true
          example: ["ORIGINAL"]
        condition:
          type: array
          items:
            $ref: "#/components/schemas/ConditionData"
          description: Optional filter by product condition assessments
          uniqueItems: true
          default: []
          nullable: true
          example: ["EXCELLENT"]
        provenance:
          type: array
          items:
            $ref: "#/components/schemas/ProvenanceData"
          description: Optional filter by provenance documentation levels
          uniqueItems: true
          default: []
          nullable: true
          example: ["PARTIAL"]
        restoration:
          type: array
          items:
            $ref: "#/components/schemas/RestorationData"
          description: Optional filter by restoration work levels
          uniqueItems: true
          default: []
          nullable: true
          example: ["UNKNOWN"]
        created:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: Optional filter by product creation date range
        updated:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: Optional filter by product last updated date range
        auctionStart:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: |
            Optional filter by auction start datetime range.
            Filters products by when their auction windows begin.
            Only matches products that have auction start times set.
        auctionEnd:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: |
            Optional filter by auction end datetime range.
            Filters products by when their auction windows end.
            Only matches products that have auction end times set.

    PostUserSearchFilterData:
      type: object
      description: Request body for creating a new search filter
      required:
        - name
        - productSearch
      properties:
        name:
          type: string
          description: User-defined name for the search filter (max 255 characters, will be truncated if longer)
          maxLength: 255
          example: "My Tech Store Search"
        productSearch:
          $ref: "#/components/schemas/ProductSearchData"

    PatchUserSearchFilterData:
      type: object
      description: |
        Partial search filter update data.
        All fields are optional and only provided fields will be updated.
        Can update the search filter name and/or the search filter criteria.
      properties:
        name:
          type: string
          description: User-defined name for the search filter (max 255 characters, will be truncated if longer)
          maxLength: 255
          nullable: true
          example: "Updated Filter Name"
        productSearch:
          allOf:
            - $ref: "#/components/schemas/PatchProductSearchData"
          nullable: true
          description: Partial search filter criteria to update

    PatchProductSearchData:
      type: object
      description: |
        Partial search filter criteria update.
        All fields are optional and only provided fields will be updated.
        Follows the same structure as ProductSearchData but with optional fields.
      properties:
        language:
          allOf:
            - $ref: "#/components/schemas/LanguageData"
          nullable: true
          description: Language for search and localized content
        currency:
          allOf:
            - $ref: "#/components/schemas/CurrencyData"
          nullable: true
          description: Currency for price display
        productQuery:
          type: string
          description: Text query for searching products (minimum 3 characters when provided)
          minLength: 3
          nullable: true
          example: "laptop bag"
        shopName:
          type: array
          items:
            type: string
          description: |
            Optional filter by exact shop names (keyword matching).
            Filters products to only those from shops with names exactly matching one of the provided values.
            This is an exact match filter, not a fuzzy text search.
          uniqueItems: true
          nullable: true
          example: ["Heritage Auctions", "Sotheby's"]
        excludeShopName:
          type: array
          items:
            type: string
          description: |
            Optional filter to exclude products from specific shop names (keyword matching).
            Products from shops with names exactly matching one of the provided values will be excluded from results.
            This is an exact match filter, not a fuzzy text search.
          uniqueItems: true
          nullable: true
          example: ["Christie's", "Bonhams"]
        shopType:
          type: array
          items:
            $ref: "#/components/schemas/ShopTypeData"
          description: Optional filter by shop types
          uniqueItems: true
          nullable: true
          example: ["MARKETPLACE"]
        price:
          allOf:
            - $ref: "#/components/schemas/RangeQueryUInt64"
          nullable: true
          description: Optional price range filter in minor currency units
        state:
          type: array
          items:
            $ref: "#/components/schemas/ProductStateData"
          description: Optional filter by product states
          uniqueItems: true
          nullable: true
          example: ["AVAILABLE", "LISTED"]
        originYear:
          allOf:
            - $ref: "#/components/schemas/RangeQueryInt32"
          nullable: true
          description: Optional filter by product origin year range
        authenticity:
          type: array
          items:
            $ref: "#/components/schemas/AuthenticityData"
          description: Optional filter by authenticity classifications
          uniqueItems: true
          nullable: true
          example: ["ORIGINAL", "LATER_COPY"]
        condition:
          type: array
          items:
            $ref: "#/components/schemas/ConditionData"
          description: Optional filter by product condition assessments
          uniqueItems: true
          nullable: true
          example: ["EXCELLENT", "GREAT"]
        provenance:
          type: array
          items:
            $ref: "#/components/schemas/ProvenanceData"
          description: Optional filter by provenance documentation levels
          uniqueItems: true
          nullable: true
          example: ["PARTIAL", "COMPLETE"]
        restoration:
          type: array
          items:
            $ref: "#/components/schemas/RestorationData"
          description: Optional filter by restoration work levels
          uniqueItems: true
          nullable: true
          example: ["NONE", "MINOR"]
        created:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: Optional filter by product creation date range
        updated:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: Optional filter by product last updated date range
        auctionStart:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: |
            Optional filter by auction start datetime range.
            Filters products by when their auction windows begin.
            Only matches products that have auction start times set.
        auctionEnd:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: |
            Optional filter by auction end datetime range.
            Filters products by when their auction windows end.
            Only matches products that have auction end times set.

    UserSearchFilterData:
      type: object
      description: Complete user search filter with metadata
      required:
        - userId
        - userSearchFilterId
        - name
        - productSearch
        - created
        - updated
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier of the user who owns this search filter
          example: "550e8400-e29b-41d4-a716-446655440000"
        userSearchFilterId:
          type: string
          format: uuid
          description: Unique identifier for this search filter
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        name:
          type: string
          description: User-defined name for the search filter
          example: "My Tech Store Search"
        productSearch:
          $ref: "#/components/schemas/ProductSearchData"
        created:
          type: string
          format: date-time
          description: When the search filter was created (RFC3339 format)
          example: "2024-01-01T10:00:00Z"
        updated:
          type: string
          format: date-time
          description: When the search filter was last updated (RFC3339 format)
          example: "2024-01-01T12:00:00Z"

    RangeQueryUInt64:
      type: object
      description: Range query for numeric values (prices in minor currency units)
      properties:
        min:
          type: integer
          minimum: 0
          description: Minimum value (inclusive)
          example: 1000
        max:
          type: integer
          minimum: 0
          description: Maximum value (inclusive)
          example: 5000

    RangeQueryDateTime:
      type: object
      description: Range query for date and time values
      properties:
        min:
          type: string
          format: date-time
          description: Minimum date and time (inclusive, RFC3339 format)
          example: "2024-01-01T00:00:00Z"
        max:
          type: string
          format: date-time
          description: Maximum date and time (inclusive, RFC3339 format)
          example: "2024-12-31T23:59:59Z"

    RangeQueryInt32:
      type: object
      description: Range query for integer values (e.g., years)
      properties:
        min:
          type: integer
          format: int32
          description: Minimum value (inclusive)
          example: 1742
        max:
          type: integer
          format: int32
          description: Maximum value (inclusive)
          example: 1953

    SortUserSearchFilterFieldData:
      type: string
      enum: [created]
      description: |
        Fields available for sorting search filters:
        - created: Sort by creation timestamp
      example: created

    UserSearchFilterCollectionData:
      type: object
      description: Paginated collection of user search filters with flattened pagination
      required:
        - items
        - from
        - size
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/UserSearchFilterData"
          description: Array of search filters in the current page
        from:
          type: integer
          minimum: 0
          description: Number of products skipped (offset)
          example: 0
        size:
          type: integer
          minimum: 0
          description: Number of products in the current page
          example: 21
        total:
          type: integer
          minimum: 0
          description: Total number of products matching the query
          nullable: true
          example: 127

    PutProductsCollectionData:
      type: object
      description: Collection of products to create or update
      required:
        - items
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/PutProductData"
          description: Array of products to process
          minItems: 1
          maxItems: 1000

    PutProductData:
      type: object
      description: |
        Data required to create or update a product.
        Shop information (shopId and shopName) is automatically enriched based on the product's URL.
      required:
        - shopsProductId
        - title
        - state
        - url
      properties:
        shopsProductId:
          type: string
          description: Shop's unique identifier for the product. Can be any arbitrary string.
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        title:
          $ref: "#/components/schemas/LocalizedTextData"
        description:
          allOf:
            - $ref: "#/components/schemas/LocalizedTextData"
          nullable: true
          description: Optional product description
        price:
          allOf:
            - $ref: "#/components/schemas/PriceData"
          nullable: true
          description: Optional product price
        priceEstimateMin:
          allOf:
            - $ref: "#/components/schemas/PriceData"
          nullable: true
          description: Optional minimum estimated price for the product
        priceEstimateMax:
          allOf:
            - $ref: "#/components/schemas/PriceData"
          nullable: true
          description: Optional maximum estimated price for the product
        state:
          $ref: "#/components/schemas/ProductStateData"
        url:
          type: string
          format: uri
          description: |
            URL to the product on the shop's website.
            The shop will be automatically identified and enriched based on the domain extracted from this URL.
          example: "https://tech-store-premium.com/products/smartphone-case"
        images:
          type: array
          items:
            type: string
            format: uri
          description: Array of image URLs for the product
          default: []
          example:
            - "https://tech-store-premium.com/images/case-1.jpg"
            - "https://tech-store-premium.com/images/case-2.jpg"
        auctionStart:
          type: string
          format: date-time
          nullable: true
          description: |
            Start datetime of the auction window for this product (RFC3339 format).
            Only applicable for products from auction houses with scheduled auction times.
            Used to indicate when bidding begins or when the item will be auctioned.
          example: "2026-02-15T10:00:00Z"
        auctionEnd:
          type: string
          format: date-time
          nullable: true
          description: |
            End datetime of the auction window for this product (RFC3339 format).
            Only applicable for products from auction houses with scheduled auction times.
            Used to indicate when bidding ends or when the auction session concludes.
          example: "2026-02-15T14:00:00Z"

    PutProductsResponse:
      type: object
      description: Response from bulk product creation/update operation with enrichment
      required:
        - skipped
      properties:
        unprocessed:
          type: array
          items:
            type: string
            format: uri
          description: |
            Product URLs that could not be processed due to temporary issues.
            These products may succeed if retried.
          default: []
          example:
            - "https://tech-store.com/products/temporary-issue"
        failed:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/PutProductError"
          description: |
            Map of product URLs to error codes for products that failed processing.
            The key is the product URL, and the value is the error code explaining why it failed.
          default: {}
          example:
            "https://unknown-shop.com/item": "SHOP_NOT_FOUND"
            "https://tech-store.com/expensive-item": "MONETARY_AMOUNT_OVERFLOW"
            "https://localhost:8080/item": "NO_DOMAIN"
        skipped:
          type: integer
          minimum: 0
          description: Number of products that were skipped during processing because they had no changes
          example: 2

    GetShopData:
      type: object
      description: Complete shop information including metadata
      required:
        - shopId
        - shopSlugId
        - name
        - shopType
        - domains
        - created
        - updated
      properties:
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
          example: "550e8400-e29b-41d4-a716-446655440000"
        shopSlugId:
          type: string
          pattern: '^[a-z0-9]+(-[a-z0-9]+)*$'
          description: |
            Human-readable slug identifier of the shop (kebab-case, derived from shop name).
            Example: "tech-store-premium" or "christies"
          example: "tech-store-premium"
        name:
          type: string
          description: Display name of the shop
          maxLength: 255
          example: "Tech Store Premium"
        shopType:
          $ref: "#/components/schemas/ShopTypeData"
        domains:
          type: array
          items:
            type: string
          description: |
            All known domains associated with the shop.
            Domains are normalized (lowercase, no scheme, no www prefix, no path/query/fragment).
          minItems: 1
          maxItems: 100
          example:
            [
              "tech-store-premium.com",
              "tech-store-premium.de",
              "apple.tech-store-premium.com",
            ]

        image:
          type: string
          format: uri
          nullable: true
          description: Optional URL to the shop's logo or image
          example: "https://tech-store-premium.com/logo.svg"
        created:
          type: string
          format: date-time
          description: When the shop was first created (RFC3339 format)
          example: "2024-01-01T10:00:00Z"
        updated:
          type: string
          format: date-time
          description: When the shop was last updated (RFC3339 format)
          example: "2024-01-01T12:00:00Z"

    PostShopData:
      type: object
      description: Data required to create a new shop
      required:
        - name
        - shopType
        - domains
      properties:
        name:
          type: string
          description: Display name of the shop
          maxLength: 255
          example: "Tech Store Premium"
        shopType:
          $ref: "#/components/schemas/ShopTypeData"
        domains:
          type: array
          items:
            type: string
          description: |
            All domains associated with the shop.
            Can be provided as full URLs (will be normalized) or as domain strings.
            Domains are normalized to lowercase without scheme, www prefix, or path/query/fragment.
            At least one domain is required, maximum 100 domains allowed.
          minItems: 1
          maxItems: 100
          example:
            - "tech-store-premium.com"
            - "tech-store-premium.de"
        image:
          type: string
          format: uri
          nullable: true
          description: Optional URL to the shop's logo or image
          example: "https://tech-store-premium.com/logo.svg"

    PatchShopData:
      type: object
      description: |
        Partial update data for a shop.
        All fields are optional - only provided fields will be updated.
        If the request body is empty or all fields are null, the shop is returned unchanged.
        
        **Note**: The shop name cannot be updated after creation as it determines the shop slug identifier.
      properties:
        shopType:
          allOf:
            - $ref: "#/components/schemas/ShopTypeData"
          nullable: true
          description: New shop type classification
        domains:
          type: array
          items:
            type: string
          nullable: true
          description: |
            Complete new set of domains for the shop.
            Can be provided as full URLs (will be normalized) or as domain strings.
            When updating domains, the complete new set must be provided (not a diff).
            Domains are normalized to lowercase without scheme, www prefix, or path/query/fragment.
            Minimum 1 domain, maximum 100 domains.
          minItems: 1
          maxItems: 100
          example:
            - "tech-store-premium.com"
            - "tech-store-premium.eu"
        image:
          type: string
          format: uri
          nullable: true
          description: New URL to the shop's logo or image
          example: "https://tech-store-premium.com/new-logo.svg"

    ShopSearchData:
      type: object
      description: Search filter configuration for shops with query parameters and filtering options
      properties:
        shopNameQuery:
          type: string
          description: Optional text query for searching shops by name
          example: "tech store"
        shopType:
          type: array
          items:
            $ref: "#/components/schemas/ShopTypeData"
          description: Optional filter by shop types
          uniqueItems: true
          default: []
          nullable: true
          example: ["AUCTION_HOUSE"]
        created:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: Optional filter by shop creation date range
        updated:
          allOf:
            - $ref: "#/components/schemas/RangeQueryDateTime"
          nullable: true
          description: Optional filter by shop last updated date range

    SortShopFieldData:
      type: string
      enum: [score, name, updated, created]
      description: |
        Fields available for sorting shops:
        - score: Sort by relevance score (default, only available when searching with text query)
        - name: Sort by shop name
        - updated: Sort by last updated timestamp
        - created: Sort by creation timestamp
      default: score
      example: name

    ShopSearchResultData:
      type: object
      description: Cursor-paginated collection of shops using keyset pagination
      required:
        - items
        - size
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/GetShopData"
          description: Array of shops in the current page
        size:
          type: integer
          minimum: 0
          description: Number of products in the current page
          example: 21
        searchAfter:
          type: array
          items: {}
          description: |
            Cursor for the next page (keyset pagination).
            Contains the sort field value and shop ID as tie-breaker: `[sortValue, shopId]`.
            Present when there are more results available.
            This is a heterogeneous JSON array.
          nullable: true
          example: '["Tech Store Premium", "550e8400-e29b-41d4-a716-446655440000"]'
        total:
          type: integer
          minimum: 0
          description: Total number of products matching the query
          nullable: true
          example: 127

    ProductKeyData:
      type: object
      description: Identifier for a product using shop ID and shop's product ID
      required:
        - shopId
        - shopsProductId
      properties:
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
          example: "550e8400-e29b-41d4-a716-446655440000"
        shopsProductId:
          type: string
          description: Shop's unique identifier for the product. Can be any arbitrary string.
          example: "6ba7b810"

    WatchlistProductData:
      type: object
      description: Watchlist product containing the product data and when it was added to the watchlist
      required:
        - product
        - notifications
        - created
        - updated
      properties:
        product:
          $ref: "#/components/schemas/GetProductData"
        notifications:
          type: boolean
          description: Whether notifications are enabled for this watchlist product
          example: false
        created:
          type: string
          format: date-time
          description: When the product was added to the watchlist (RFC3339 format)
          example: "2024-01-15T08:00:00Z"
        updated:
          type: string
          format: date-time
          description: When the watchlist product was last updated (RFC3339 format)
          example: "2024-01-15T08:00:00Z"

    WatchlistCollectionData:
      type: object
      description: Paginated collection of watchlist products using cursor-based pagination
      required:
        - items
        - size
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/WatchlistProductData"
          description: Array of watchlist products in the current page
        size:
          type: integer
          minimum: 0
          description: Number of products in the current page
          example: 21
        searchAfter:
          type: string
          format: date-time
          description: Cursor for the next page (RFC3339 timestamp). Present when there are more results.
          nullable: true
          example: "2024-01-15T08:00:00Z"
        total:
          type: integer
          minimum: 0
          description: Total number of products (optional, may not be available for cursor-based pagination)
          nullable: true
          example: 127

    WatchlistProductPatch:
      type: object
      description: Patch object for updating watchlist product settings
      properties:
        notifications:
          type: boolean
          description: Whether to enable or disable notifications for this watchlist product
          example: true

    WatchlistProductPatchResponse:
      type: object
      description: Response after patching a watchlist product, containing core product identifiers and notification settings
      required:
        - shopId
        - shopsProductId
        - productId
        - notifications
        - created
        - updated
      properties:
        shopId:
          type: string
          format: uuid
          description: Unique identifier of the shop
          example: "550e8400-e29b-41d4-a716-446655440000"
        shopsProductId:
          type: string
          description: Shop's unique identifier for the product
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        productId:
          type: string
          format: uuid
          description: Internal product identifier
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
        notifications:
          type: boolean
          description: Current notification setting for this watchlist product
          example: true
        created:
          type: string
          format: date-time
          description: When the product was added to the watchlist (RFC3339 format)
          example: "2024-01-15T08:00:00Z"
        updated:
          type: string
          format: date-time
          description: When the watchlist product was last updated (RFC3339 format)
          example: "2024-01-15T08:30:00Z"

    SortWatchlistProductFieldData:
      type: string
      enum: [created]
      description: |
        Fields available for sorting watchlist products:
        - created: Sort by when product was added to watchlist
      example: created

    PutProductError:
      type: string
      enum:
        [
          SHOP_NOT_FOUND,
          MONETARY_AMOUNT_OVERFLOW,
          PRODUCT_ENRICHMENT_FAILED,
          NO_DOMAIN,
        ]
      description: |
        Error codes for products that failed during processing:
        - SHOP_NOT_FOUND: The shop associated with the product's domain is not registered in the system
        - MONETARY_AMOUNT_OVERFLOW: The price amount exceeds the maximum supported value during currency conversion
        - PRODUCT_ENRICHMENT_FAILED: Failed to enrich the product with additional shop and price information
        - NO_DOMAIN: The product URL does not contain a valid domain that can be extracted
      example: SHOP_NOT_FOUND

    GetUserAccountData:
      type: object
      description: Complete user account information
      required:
        - userId
        - email
        - created
        - updated
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier for the user
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          description: User's email address
          example: "user@example.com"
        firstName:
          type: string
          maxLength: 64
          nullable: true
          description: User's first name (optional, max 64 characters)
          example: "John"
        lastName:
          type: string
          maxLength: 64
          nullable: true
          description: User's last name (optional, max 64 characters)
          example: "Doe"
        language:
          allOf:
            - $ref: "#/components/schemas/LanguageData"
          nullable: true
          description: User's preferred language (optional)
        currency:
          allOf:
            - $ref: "#/components/schemas/CurrencyData"
          nullable: true
          description: User's preferred currency (optional)
        created:
          type: string
          format: date-time
          description: When the user account was created (RFC3339 format)
          example: "2024-01-01T10:00:00Z"
        updated:
          type: string
          format: date-time
          description: When the user account was last updated (RFC3339 format)
          example: "2024-01-01T12:00:00Z"

    PatchUserAccountData:
      type: object
      description: |
        Partial user account update data.
        All fields are optional - only provided fields will be updated.
      properties:
        firstName:
          type: string
          maxLength: 64
          nullable: true
          description: New first name (max 64 characters)
          example: "Jane"
        lastName:
          type: string
          maxLength: 64
          nullable: true
          description: New last name (max 64 characters)
          example: "Smith"
        language:
          allOf:
            - $ref: "#/components/schemas/LanguageData"
          nullable: true
          description: New preferred language
        currency:
          allOf:
            - $ref: "#/components/schemas/CurrencyData"
          nullable: true
          description: New preferred currency

tags:
  - name: Products
    description: Operations related to product retrieval and search
  - name: Search Filters
    description: Operations for managing user search filters
  - name: Shops
    description: Operations related to shop retrieval and search
  - name: User Account
    description: Operations for managing user account information
  - name: Watchlist
    description: Operations for managing user's product watchlist
